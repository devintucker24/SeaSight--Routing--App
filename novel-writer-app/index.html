<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Novel Writer</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">
                    <i class="fas fa-feather-alt"></i>
                    AI Novel Writer
                </h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" id="saveBtn">
                        <i class="fas fa-save"></i>
                        Save
                    </button>
                    <button class="btn btn-primary" id="exportBtn">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Tab Navigation -->
                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="writing">
                        <i class="fas fa-pen"></i>
                        Writing
                    </button>
                    <button class="tab-btn" data-tab="codex">
                        <i class="fas fa-book"></i>
                        Codex
                    </button>
                </div>

                <!-- Writing Tab Content -->
                <div class="tab-content active" id="writingTab">
                <div class="sidebar-section">
                    <h3>Novel Structure</h3>
                    <div class="novel-info">
                        <input type="text" id="novelTitle" placeholder="Novel Title" class="input-field">
                        <textarea id="novelSummary" placeholder="Brief summary..." class="input-field" rows="3"></textarea>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>Chapters</h3>
                    <div class="chapters-list" id="chaptersList">
                        <div class="chapter-item active" data-chapter="1">
                            <span class="chapter-number">1</span>
                            <span class="chapter-title">Chapter 1</span>
                            <button class="chapter-delete" title="Delete Chapter">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-outline" id="addChapterBtn">
                        <i class="fas fa-plus"></i>
                        Add Chapter
                    </button>
                </div>


                <div class="sidebar-section">
                    <h3>Writing Stats</h3>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-label">Words:</span>
                            <span class="stat-value" id="wordCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Characters:</span>
                            <span class="stat-value" id="charCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pages:</span>
                            <span class="stat-value" id="pageCount">0</span>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Codex Tab Content -->
                <div class="tab-content" id="codexTab">
                    <div class="sidebar-section">
                        <h3>
                            <i class="fas fa-book-open"></i>
                            Codex Entries
                        </h3>
                        <input type="text" id="codexSearch" placeholder="Search codex entries..." class="input-field">
                        <div class="codex-categories">
                            <button class="btn btn-outline btn-small codex-category-btn active" data-category="all">All</button>
                            <button class="btn btn-outline btn-small codex-category-btn" data-category="magic">Magic Systems</button>
                            <button class="btn btn-outline btn-small codex-category-btn" data-category="power">Power Systems</button>
                            <button class="btn btn-outline btn-small codex-category-btn" data-category="location">Locations</button>
                            <button class="btn btn-outline btn-small codex-category-btn" data-category="character">Characters</button>
                            <button class="btn btn-outline btn-small codex-category-btn" data-category="lore">Lore & History</button>
                            <button class="btn btn-outline btn-small codex-category-btn" data-category="progression">Progression</button>
                        </div>
                        <button class="btn btn-primary btn-small" id="addCodexEntryBtn">
                            <i class="fas fa-plus"></i>
                            Add New Entry
                        </button>
                        <div class="codex-list" id="codexList">
                            <!-- Codex entries will be populated here -->
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Editor Area -->
            <div class="editor-container">
                <div class="editor-header">
                    <h2 id="currentChapterTitle">Chapter 1</h2>
                    <div class="editor-tools">
                        <button class="tool-btn" id="boldBtn" title="Bold">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="tool-btn" id="italicBtn" title="Italic">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button class="tool-btn" id="underlineBtn" title="Underline">
                            <i class="fas fa-underline"></i>
                        </button>
                        <div class="tool-separator"></div>
                        <button class="tool-btn" id="formatH1Btn" title="Heading 1">
                            <i class="fas fa-heading"></i>1
                        </button>
                        <button class="tool-btn" id="formatH2Btn" title="Heading 2">
                            <i class="fas fa-heading"></i>2
                        </button>
                        <button class="tool-btn" id="formatH3Btn" title="Heading 3">
                            <i class="fas fa-heading"></i>3
                        </button>
                        <div class="tool-separator"></div>
                        <button class="tool-btn" id="insertUnorderedListBtn" title="Unordered List">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button class="tool-btn" id="insertOrderedListBtn" title="Ordered List">
                            <i class="fas fa-list-ol"></i>
                        </button>
                        <button class="tool-btn" id="formatBlockquoteBtn" title="Blockquote">
                            <i class="fas fa-quote-right"></i>
                        </button>
                        <div class="tool-separator"></div>
                        <button class="tool-btn" id="alignLeftBtn" title="Align Left">
                            <i class="fas fa-align-left"></i>
                        </button>
                        <button class="tool-btn" id="alignCenterBtn" title="Align Center">
                            <i class="fas fa-align-center"></i>
                        </button>
                        <button class="tool-btn" id="alignRightBtn" title="Align Right">
                            <i class="fas fa-align-right"></i>
                        </button>
                        <button class="tool-btn" id="alignJustifyBtn" title="Justify">
                            <i class="fas fa-align-justify"></i>
                        </button>
                        <div class="tool-separator"></div>
                        <button class="tool-btn" id="undoBtn" title="Undo">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="tool-btn" id="redoBtn" title="Redo">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
                
                <div class="editor-wrapper">
                    <div class="editor" id="textEditor" contenteditable="true" spellcheck="true">
                        <p>Start writing your novel here...</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- AI Response Modal -->
        <div class="modal" id="aiModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>AI Assistant</h3>
                    <button class="modal-close" id="closeModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="ai-response" id="aiResponse">
                        <!-- AI response will be displayed here -->
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" id="rejectSuggestion">Reject</button>
                        <button class="btn btn-primary" id="acceptSuggestion">Accept</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Worldbuilding Entry Modal -->
        <div class="modal" id="worldbuildingModal">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3 id="worldbuildingModalTitle">Add Entry</h3>
                    <button class="modal-close" id="closeWorldbuildingModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="worldbuildingForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="entryName">Name:</label>
                                <input type="text" id="entryName" class="input-field" required>
                            </div>
                            <div class="form-group">
                                <label for="entryType">Type:</label>
                                <select id="entryType" class="input-field" required>
                                    <option value="magic">Magic System</option>
                                    <option value="power">Power System</option>
                                    <option value="location">Location</option>
                                    <option value="character">Character</option>
                                    <option value="lore">Lore & History</option>
                                    <option value="progression">Progression</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="entryAliases">Keywords/Aliases (comma-separated):</label>
                            <input type="text" id="entryAliases" class="input-field" placeholder="e.g., fire magic, flame arts, pyromancy">
                            <small>These keywords help the AI identify when to reference this entry</small>
                        </div>

                        <div class="form-group">
                            <label for="entryDescription">Description:</label>
                            <textarea id="entryDescription" class="input-field" rows="4" required></textarea>
                        </div>

                        <!-- Magic System Specific Fields -->
                        <div class="conditional-fields" id="magicFields" style="display: none;">
                            <h4>Magic System Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="magicSource">Power Source:</label>
                                    <input type="text" id="magicSource" class="input-field" placeholder="e.g., Mana, Qi, Life Force">
                                </div>
                                <div class="form-group">
                                    <label for="magicLimitations">Limitations:</label>
                                    <input type="text" id="magicLimitations" class="input-field" placeholder="e.g., Mana depletion, cooldowns">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="magicRules">Rules & Mechanics:</label>
                                <textarea id="magicRules" class="input-field" rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Power System Specific Fields -->
                        <div class="conditional-fields" id="powerFields" style="display: none;">
                            <h4>Power System Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="powerLevels">Power Levels/Ranks:</label>
                                    <textarea id="powerLevels" class="input-field" rows="2" placeholder="e.g., Novice, Adept, Expert, Master"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="powerProgression">Progression Method:</label>
                                    <input type="text" id="powerProgression" class="input-field" placeholder="e.g., Training, Combat, Meditation">
                                </div>
                            </div>
                        </div>

                        <!-- Character Specific Fields -->
                        <div class="conditional-fields" id="characterFields" style="display: none;">
                            <h4>Character Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="characterLevel">Level/Rank:</label>
                                    <input type="text" id="characterLevel" class="input-field" placeholder="e.g., Level 25, Gold Rank">
                                </div>
                                <div class="form-group">
                                    <label for="characterClass">Class/Role:</label>
                                    <input type="text" id="characterClass" class="input-field" placeholder="e.g., Mage, Warrior, Assassin">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="characterAbilities">Abilities/Skills:</label>
                                <textarea id="characterAbilities" class="input-field" rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Location Specific Fields -->
                        <div class="conditional-fields" id="locationFields" style="display: none;">
                            <h4>Location Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="locationType">Type:</label>
                                    <input type="text" id="locationType" class="input-field" placeholder="e.g., City, Dungeon, Academy">
                                </div>
                                <div class="form-group">
                                    <label for="locationDanger">Danger Level:</label>
                                    <input type="text" id="locationDanger" class="input-field" placeholder="e.g., Safe, Moderate, High">
                                </div>
                            </div>
                        </div>

                        <!-- Progression Specific Fields -->
                        <div class="conditional-fields" id="progressionFields" style="display: none;">
                            <h4>Progression Details</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="progressionCurrent">Current Level:</label>
                                    <input type="text" id="progressionCurrent" class="input-field">
                                </div>
                                <div class="form-group">
                                    <label for="progressionNext">Next Milestone:</label>
                                    <input type="text" id="progressionNext" class="input-field">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="progressionRequirements">Requirements:</label>
                                <textarea id="progressionRequirements" class="input-field" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancelWorldbuilding">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Entry</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Create Beat Modal -->
        <div class="modal" id="createBeatModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create a Beat</h3>
                    <button class="modal-close" id="closeCreateBeatModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="createBeatForm">
                        <div class="form-group">
                            <label for="beatInstructions">What kind of beat do you want to create?</label>
                            <textarea id="beatInstructions" class="input-field" rows="5" placeholder="e.g., A sudden betrayal by a trusted ally, a mysterious artifact is discovered, a character gains a new power..."></textarea>
                            <small>Describe the core event or development you want the AI to generate.</small>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancelCreateBeat">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="generateBeatBtn">Generate Beat</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="modal-close" id="closeSettingsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <label for="openrouterKey">OpenRouter API Key:</label>
                        <input type="password" id="openrouterKey" class="input-field" placeholder="Enter your OpenRouter API key">
                        <small>Your API key is stored locally and never sent to our servers.</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>AI is thinking...</p>
            </div>
        </div>
    </div>

    <!-- Settings Button (Fixed) -->
    <button class="settings-btn" id="settingsBtn" title="Settings">
        <i class="fas fa-cog"></i>
    </button>

    <script src="script.js"></script>

    <!-- Floating AI Toolbar -->
    <div class="floating-ai-toolbar" id="floatingAiToolbar">
        <select id="aiModelFloating" class="input-field ai-model-select">
            <option value="anthropic/claude-3-haiku">Claude 3 Haiku</option>
            <option value="anthropic/claude-3-sonnet">Claude 3 Sonnet</option>
            <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
            <option value="openai/gpt-4o">GPT-4o</option>
            <option value="meta-llama/llama-3.1-8b-instruct">Llama 3.1 8B</option>
            <option value="grok/grok-3-mini">Grok 3 Mini</option>
            <option value="google/gemini-2.5-flash">Gemini 2.5 Flash</option>
        </select>
        <button class="tool-btn" id="floatingBoldBtn" title="Bold">
            <i class="fas fa-bold"></i>
        </button>
        <button class="tool-btn" id="floatingItalicBtn" title="Italic">
            <i class="fas fa-italic"></i>
        </button>
        <button class="tool-btn" id="floatingUnderlineBtn" title="Underline">
            <i class="fas fa-underline"></i>
        </button>
        <button class="tool-btn" id="floatingFormatH1Btn" title="Heading 1">
            <i class="fas fa-heading"></i>1
        </button>
        <button class="tool-btn" id="floatingFormatH2Btn" title="Heading 2">
            <i class="fas fa-heading"></i>2
        </button>
        <button class="tool-btn" id="floatingFormatH3Btn" title="Heading 3">
            <i class="fas fa-heading"></i>3
        </button>
        <button class="tool-btn" id="floatingInsertUnorderedListBtn" title="Unordered List">
            <i class="fas fa-list-ul"></i>
        </button>
        <button class="tool-btn" id="floatingInsertOrderedListBtn" title="Ordered List">
            <i class="fas fa-list-ol"></i>
        </button>
        <button class="tool-btn" id="floatingFormatBlockquoteBtn" title="Blockquote">
            <i class="fas fa-quote-right"></i>
        </button>
        <button class="tool-btn" id="floatingAlignLeftBtn" title="Align Left">
            <i class="fas fa-align-left"></i>
        </button>
        <button class="tool-btn" id="floatingAlignCenterBtn" title="Align Center">
            <i class="fas fa-align-center"></i>
        </button>
        <button class="tool-btn" id="floatingAlignRightBtn" title="Align Right">
            <i class="fas fa-align-right"></i>
        </button>
        <button class="tool-btn" id="floatingAlignJustifyBtn" title="Justify">
            <i class="fas fa-align-justify"></i>
        </button>
        <button class="tool-btn" id="aiRephraseBtn" title="Rephrase Selected Text">
            <i class="fas fa-redo-alt"></i> Rephrase
        </button>
        <button class="tool-btn" id="aiExpandBtn" title="Expand Selected Text">
            <i class="fas fa-expand-alt"></i> Expand
        </button>
        <button class="tool-btn" id="aiSummarizeBtn" title="Summarize Selected Text">
            <i class="fas fa-compress-alt"></i> Summarize
        </button>
        <button class="tool-btn" id="aiGetSuggestionsBtn" title="Get AI Suggestions">
            <i class="fas fa-lightbulb"></i> Suggestions
        </button>
        <button class="tool-btn" id="aiCreateBeatBtn" title="Create a Beat">
            <i class="fas fa-music"></i> Create Beat
        </button>
    </div>
</body>
</html>
