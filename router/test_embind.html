<!DOCTYPE html>
<html>
<head>
    <title>SeaSight Router - Embind Test</title>
    <script src="https://unpkg.com/comlink@4.4.1/dist/umd/comlink.js"></script>
</head>
<body>
    <h1>SeaSight Router - Embind Integration Test</h1>
    <div id="output"></div>
    
    <script type="module">
        import { RouterWrapper } from './build/SeaSightRouter.js';
        
        async function testRouter() {
            const output = document.getElementById('output');
            
            try {
                // Create router instance
                const router = new RouterWrapper(30.0, 50.0, -80.0, -60.0, 0.5, 0.5);
                
                // Set safety caps
                router.setSafetyCaps(4.0, 30.0, 15.0);
                
                // Add some test mask data
                router.addMaskData(5, 5, [true, false, false]);   // Land
                router.addMaskData(6, 6, [false, true, false]);   // Shallow
                router.addMaskData(7, 7, [false, false, true]);   // Restricted
                
                // Test route solving
                const path = router.solve(0, 0, 10, 10, 0.0);
                output.innerHTML += `<p>Path found with ${path.length} nodes</p>`;
                
                // Test edge creation
                const edge = router.createEdge(0, 0, 5, 5);
                output.innerHTML += `<p>Edge from (0,0) to (5,5):</p>`;
                output.innerHTML += `<ul>`;
                output.innerHTML += `<li>Distance: ${edge.distance_nm.toFixed(2)} nm</li>`;
                output.innerHTML += `<li>Time: ${edge.time_hours.toFixed(2)} hours</li>`;
                output.innerHTML += `<li>Sample points: ${edge.sample_points.length}</li>`;
                output.innerHTML += `</ul>`;
                
                // Test coordinate conversion
                const gridPos = router.latLonToGrid(40.0, -70.0);
                output.innerHTML += `<p>Grid position for (40°N, 70°W): (${gridPos.i}, ${gridPos.j})</p>`;
                
                const latLon = router.gridToLatLon(20, 20);
                output.innerHTML += `<p>Lat/Lon for grid (20, 20): (${latLon.lat.toFixed(2)}°N, ${latLon.lon.toFixed(2)}°E)</p>`;
                
                // Test anti-meridian functions
                const normalized = router.normalizeLongitude(190.0);
                output.innerHTML += `<p>Normalize 190° to: ${normalized}°</p>`;
                
                const crosses = router.crossesAntiMeridian(179.0, -179.0);
                output.innerHTML += `<p>Crosses anti-meridian (179°, -179°): ${crosses ? 'Yes' : 'No'}</p>`;
                
                const distance = router.greatCircleDistance(0.0, 179.0, 0.0, -179.0);
                output.innerHTML += `<p>Distance 179° to -179°: ${distance.toFixed(2)} nm</p>`;
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
                console.error(error);
            }
        }
        
        // Run test when page loads
        testRouter();
    </script>
</body>
</html>
